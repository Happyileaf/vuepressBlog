---
theme: smartblue
---

「这是我参与11月更文挑战的第9天，活动详情查看：[2021最后一次更文挑战](https://juejin.cn/post/7023643374569816095/ "https://juejin.cn/post/7023643374569816095/")」

## 浏览器工作原理 输入URL之后发生了什么



### 


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61f63ac3049d4c8bad5374f14b8d8ec2~tplv-k3u1fbpfcp-watermark.image?)

图片来源于文章[导航流程：从输入URL到页面展示这中间发生了什么](https://blog.poetries.top/browser-working-principle/guide/part1/lesson04.html#%E4%BB%8E%E8%BE%93%E5%85%A5url%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA)

1. 用户输入url并回车
2. 浏览器进程检查url，组装协议，构成完整的url
1.  浏览器解析URL获取协议，域名，端口，路径

2.  查看浏览器是否有资源的缓存

    1.  有。判断是否过期

        1.  没过期。直接读取缓存

        1.  过期。

            1.  Etag和If-None-Match
            1.  Last-Modify和lf-Modified-Since
            1.  文件修改了则把新资源发给浏览器（状态码200），没修改则告诉浏览器读取缓存（状态码304）

    1.  没有则进行下一步

3.  首先进行DNS解析

    1.  寻找浏览器是否存在缓存，若没有
    1.  寻找操作系统是否存在缓存，若没有
    1.  寻找hosts文件中是否有域名和ip的对应关系，若没有
    1.  查找路由器中是否有缓存
    1.  寻找DNS服务器是否没缓存，若没有
    1.  向根域名服务器发送请求

4.  生成HTTP请求

5.  建立TCP连接，三次握手

    1.  客户端发送一个SYN=1,Seq=X的TCP包
    1.  服务端发回一个SYN=1,ACK=X+1，Seq=Y的TCP包
    1.  客户端发送ACK=Y+1，Seq=Y + 1的TCP包

6.  如果是HTTP请求

    对HTTP报文进行报文分割并标记序号和端口号

7.  如果是HTTPS请求

    1.  将HTTP报文交给TLS处理，TLS和服务端进行TLS握手，交换版本信息，加密算法，压缩算法，随机数（浏览器一个，客户端一个）。
    1.  服务端发送证书，浏览器用CA的公钥对其进行验证。
    1.  浏览器用服务端的公钥加密生成的预备主密码发送给服务端，两个随机数和预备主密码生成主密码
    1.  使用主密码生成对称加密的密钥对，消息认证码的密钥对，对称加密的CBC分组（分组模式）需要的初始化向量密钥对。
    1.  握手之后进行加密，对HTTP报文分组，分组后压缩，压缩后的数据和MAC一起加密。
    1.  对称加密保障私密性，消息认证码保障完整性，数字证书保障认证，防止中间人攻击。

8.  对TCP报文打包，加入源IP地址和目标IP地址。

9.  根据目标IP地址和路由表，查询下一跳路由。使用ARP查询下一跳路由的MAC地址。

10.  对IP报文打包并附上MAC地址。

11.  发送数据，服务端接收到请求并返回响应。

12.  浏览器接收到HTTP响应，关闭TCP连接或保持复用，四次挥手。

13.  （如果返回了HTML）根据响应头的字符集进行解码

14.  如果响应头没有字符集，则浏览器会默认用一套解码规则，当解析html解析到meta标签中的编码规则时，则替换成新的解码方式重新解码。

15.  资源预解析，会将一些请求资源提前加入请求队列中

16.  解析HTML为DOM树

    1.  标记化（tokenizing）: 将HTML解析成标记
    1.  构建树（tree construction）: 根据标记生成DOM树

17.  解析CSS为CSSOM

18.  根据DOM树和CSSOM生成DOM渲染树

    从DOM的根节点遍历所有可见节点，对其应用对应的CSSOM规则。不可见节点包括（script, meta标签， 被css隐藏的节点）

19.  布局：浏览器获取每个渲染对象的位置和尺寸

20.  绘制：将计算好的像素绘制到屏幕

21.  渲染层/合成层合并
